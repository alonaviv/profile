{% extends 'base.html' %}

{% block content %}

{% if anchor %}
<script type='text/javascript'>
window.location = (""+window.location).replace(/#[A-Za-z0-9_]*$/,'')+"#{{anchor}}";
</script>
{% endif %}

<h1>כתיבת דיווחים לשיעור {{ class }}</h1>

{% if not evaluations %}
<br>
<div class="centered_container">
<div class=error_message>לא הוספת תלמידים לשיעור זה</div>
</div>

{% else %}
<div class="centered_container ">
{% if class.completed_evals_in_current_trimester == class.all_evals_in_current_trimester%}
    <h2 class='announcment_happy'>כתבת את כל {{class.completed_evals_in_current_trimester|length}} הדיווחים לשיעור זה! איזה כיף!</h2>
{% else %}
    <h2 class='announcment'>כתבת {{class.completed_evals_in_current_trimester|length}} מתוך {{class.all_evals_in_current_trimester|length}} דיווחים</h2>
{% endif %}
</div>

<div class="block-container reverse">
    <a class ="back_button" href="{% url 'write' %}">חזרה לרשימת השיעורים</a>
</div>

{% for evaluation in evaluations %}

<div class="centered_container form_styling">
<form action = "{% url 'write_class_evaluations' class.id %}" method="post" 
{% if evaluation.is_submitted %} onsubmit="window.confirm_change()" {% endif %}>
    {% csrf_token %}
<a id=anchor_{{evaluation.id}} class="underline">
    דיווח על {{ evaluation.student }} ({% if evaluation.student.homeroom_teacher %} {{evaluation.student.homeroom_teacher.printable_description}} {% else %} עדיין לא צורפ\ה לחונכ/ת {% endif %})
</a>
    <br>
    {% if not evaluation.is_student_in_class %}
    <br>
    <div class="flex_container no_p_margin column"><p class="error_message">השתתפ/ה בשיעור זה במהלך הסמסטר, אך עזב/ה.</p>
    <a href="{% url 'remove_evaluation' evaluation.id %}" class="clickable basic_link" onclick="return confirm('האם {{pronoun_dict.you}} {{pronoun_dict.sure}} ש{{pronoun_dict.you}} לא רוצה לדווח על {{evaluation.student.first_name}} בסמסטר זה, אף שהשתתפ/ה בשיעור?')">איני {{pronoun_dict.interested}}
        לדווח על
        {{evaluation.student.first_name}}
        בסמסטר זה</a>
        {% if messages and evaluation.is_submitted %}
        {% for message in messages %}
        <div class="error_message">
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}
    </div>
    {% endif %}
    <input type="hidden" name="evaluation_id" value="{{evaluation.id}}">
    <textarea name="evaluation_text" cols="60" rows="20">{{evaluation.evaluation_text}}</textarea>
    <br>
    <div class="flex_container">
    <input type="submit" value="{{pronoun_dict.send}} דיווח">
    {% if evaluation.is_submitted %}
    <i class="fas fa-check-circle fa-2x"></i>
    {% endif %}
    </div>

    <br><br>
</form>
</div> 
{% endfor %}

<script type="text/javascript">
window.confirm_change = function() { 
    var isValid = confirm('האם {{pronoun_dict.you}} {{pronoun_dict.sure}} ש{{pronoun_dict.you}} רוצה לשנות את הדיווח?');if (!isValid) { event.preventDefault();  alert("הדיווח הקודם נותר כשהיה. על מנת לשנות את הדיווח לטקסט החדש, {{pronoun_dict.click}} על ״{{pronoun_dict.send}} דיווח״ שוב. ");}}
    </script>


{% endif %}

{% endblock %}

